<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>趣友</title>
	<link rel='stylesheet' href="/aplugin/bootstrap/css/bootstrap.min.css">
	<link rel='stylesheet' href='/aplugin/css/quyoupublic.css'>
	<script  src='/aplugin/js/jquery-1.12.2.js'></script>
	<script  src='/aplugin/bootstrap/js/bootstrap.min.js'></script>
	<script src='/aplugin/js/quyou.js'></script>
	<script type='text/javascript' src='/aplugin/ueditor/ueditor.config.js'></script>
	<script type='text/javascript' src='/aplugin/ueditor/ueditor.all.js'></script>
  </head>
  <body>
<nav class="navbar navbar-default">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar-collapse-head" aria-expanded="false">
			<span class="sr-only"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="#">趣友</a>
		</div>
		<div class="collapse navbar-collapse" id="bs-navbar-collapse-head">
			<ul class = "nav navbar-nav">
				<li class="active"><a href="###">主页</a></li>
				<li ><a href="###">影视</a></li>
				<li><a href="###">音乐</a></li>
				<li><a href="###">读书</a></li>
				<li><a href="/circle/tocircle">圈</a></li>
			</ul>
			<div id="beforelogin"  class="navbar-right"  style="display:none">
				<button type="button" class="btn btn-default navbar-btn" id="loginbtn">登陆</button>
				<button type="button" class="btn btn-default navbar-btn" id="registerbtn">注册</button>
			</div>
		   <div id="afterlogin" class="navbar-right" style="display:block">
		   		<ul class="nav navbar-nav">
		   			<li><a href="###" id="name" class="dropdown-toggle" data-toggle="dropdown" role="button" area-haspopup="true" aria-expanded="true" aria-expanded="false"><span id='user_name'></span><span class="caret"></span></a>
		   				<ul id="name" class="dropdown-menu" >
		   					<li><a href="###"  id='userinfo'>个人信息</a></li>
		   					<li><a href='###'  id='logout'>退出</a></li>
		   				</ul>
		   			</li>
		   	    	<li><a href="###" id='message'>消息</a></li>
		   	   </ul>
		   	</div>
		</div>
	</div>
</nav>
<script>
 $(document).ready(function()
{
	 var user_id = '';
	 $("#loginbtn").click(function(){
		 window.location.href="/quyouusers/tologin";
	 });
	 $("#registerbtn").click(function(){
		 window.location.href="/quyouusers/toregister";
	 });
	 $('#logout').click(function(){
		 $.ajax({
			 url:'/quyouusers/logout',
			 data:'',
			 type:'POST',
			 dataType:'json',
			 success:function(data){
				 console.log(data);
				 window.location.href='/';
			 }
		 });
	 });
	$('#userinfo').click(function(){
		 window.location.href='/quyouusers/touserinfo/'+user_id;
	 });
	 var getuser = $.ajax({
		 url:'/quyouusers/getloginstate',
		 data:'',
		 type:'POST',
		 dataType:'json',
		 success:function(data){
			 console.log(data);
			 if(data['error_code'] == -1)
			{
				 $('#beforelogin').css('display','block');
				 $('#afterlogin').css('display','none');
			 }
			 else
			{
				 $('#beforelogin').css('display','none');
				 $('#afterlogin').css('display','block');
				 $('#user_name').html(data['result']['user_name']);
				 user_id = data['result']['user_id'];
		    }
		 }
	 });
	 $.when(getuser).then(function(){
		 $.ajax({
			 url:'',
			 data:'',
			 dataType:'json',
			 type:'POST',
			 success:function(data){
				 console.log(data);
			 }
		 });
	 });
	 var socket = new WebSocket("ws://localhost:9501");
	 socket.onmessage = function(event)
	 {
		 console.log(event.data);
	 }
	 socket.onopen = function(event){
		 socket.send("i an the client");
	 }
 });
</script>